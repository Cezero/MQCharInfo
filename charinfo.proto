syntax = "proto3";

package mq.proto.charinfo;

enum CharinfoMessageId {
  None = 0;
  Publish = 1;
  Remove = 2;
  Update = 3;
  Joined = 4;
}

// Field IDs for delta updates. Match CharinfoPublish field order.
enum CharinfoFieldId {
  FIELD_NONE = 0;
  FIELD_sender = 1;
  FIELD_name = 2;
  FIELD_id = 3;
  FIELD_level = 4;
  FIELD_class_info = 5;
  FIELD_pct_hps = 6;
  FIELD_pct_mana = 7;
  FIELD_target = 8;
  FIELD_target_hp = 9;
  FIELD_zone = 10;
  FIELD_buff_spells = 11;
  FIELD_buff_durations = 12;
  FIELD_short_buff_spells = 13;
  FIELD_short_buff_durations = 14;
  FIELD_pet_buff_spells = 15;
  FIELD_pet_buff_durations = 16;
  FIELD_free_buff_slots = 17;
  FIELD_detrimentals = 18;
  FIELD_count_poison = 19;
  FIELD_count_disease = 20;
  FIELD_count_curse = 21;
  FIELD_count_corruption = 22;
  FIELD_pet_hp = 23;
  FIELD_max_endurance = 24;
  FIELD_current_hp = 25;
  FIELD_max_hp = 26;
  FIELD_current_mana = 27;
  FIELD_max_mana = 28;
  FIELD_current_endurance = 29;
  FIELD_pct_endurance = 30;
  FIELD_pet_id = 31;
  FIELD_pet_affinity = 32;
  FIELD_no_cure = 33;
  FIELD_life_drain = 34;
  FIELD_mana_drain = 35;
  FIELD_endu_drain = 36;
  FIELD_state_bits = 37;
  FIELD_detr_state_bits = 38;
  FIELD_bene_state_bits = 39;
  FIELD_casting_spell_id = 40;
  FIELD_combat_state = 41;
  FIELD_gem = 42;
  FIELD_version = 43;
  FIELD_experience = 44;
  FIELD_make_camp = 45;
  FIELD_macro = 46;
  FIELD_free_inventory = 47;
}

message SpellInfo {
  string name = 1;
  int32 id = 2;
  int32 category = 3;
  int32 level = 4;
}

// Wrappers for delta repeated fields.
message SpellInfoList {
  repeated SpellInfo spell = 1;
}

message Int32List {
  repeated int32 value = 1;
}

message ClassInfo {
  string name = 1;
  string short_name = 2;
  int32 id = 3;
}

message TargetInfo {
  string name = 1;
  int32 id = 2;
}

message ZoneInfo {
  string name = 1;
  string short_name = 2;
  int32 id = 3;
  int32 instance_id = 4;
  float x = 5;
  float y = 6;
  float z = 7;
  float heading = 8;
}

message ExperienceInfo {
  float pct_exp = 1;
  float pct_aa_exp = 2;
  float pct_group_leader_exp = 3;
  int32 total_aa = 4;
  int32 aa_spent = 5;
  int32 aa_unused = 6;
  int32 aa_assigned = 7;
}

message MakeCampInfo {
  int32 status = 1;
  float x = 2;
  float y = 3;
  float radius = 4;
  float distance = 5;
}

message MacroInfo {
  int32 macro_state = 1;
  string macro_name = 2;
}

message CharinfoPublish {
  string sender = 1;
  string name = 2;
  int32 id = 3;
  int32 level = 4;
  ClassInfo class_info = 5;
  int32 pct_hps = 6;
  int32 pct_mana = 7;
  TargetInfo target = 8;
  int32 target_hp = 9;
  ZoneInfo zone = 10;
  repeated SpellInfo buff_spells = 11;
  repeated int32 buff_durations = 12;
  repeated SpellInfo short_buff_spells = 13;
  repeated int32 short_buff_durations = 14;
  repeated SpellInfo pet_buff_spells = 15;
  repeated int32 pet_buff_durations = 16;
  int32 free_buff_slots = 17;
  int32 detrimentals = 18;
  int32 count_poison = 19;
  int32 count_disease = 20;
  int32 count_curse = 21;
  int32 count_corruption = 22;
  int32 pet_hp = 23;
  int32 max_endurance = 24;
  // Vitals (top-level)
  int32 current_hp = 25;
  int32 max_hp = 26;
  int32 current_mana = 27;
  int32 max_mana = 28;
  int32 current_endurance = 29;
  int32 pct_endurance = 30;
  // Pet (top-level)
  int32 pet_id = 31;
  bool pet_affinity = 32;
  // Detrimentals / counters (top-level)
  int64 no_cure = 33;
  int64 life_drain = 34;
  int64 mana_drain = 35;
  int64 endu_drain = 36;
  fixed32 state_bits = 37;
  fixed32 detr_state_bits = 38;
  fixed32 bene_state_bits = 39;
  // State / combat
  int32 casting_spell_id = 40;
  int32 combat_state = 41;
  // Gems (ordered spell IDs)
  repeated int32 gem = 42;
  // Version
  float version = 43;
  // Experience submessage
  ExperienceInfo experience = 44;
  // MakeCamp submessage (only when MQ2MoveUtils loaded)
  MakeCampInfo make_camp = 45;
  // Macro submessage
  MacroInfo macro = 46;
  // Free inventory by size (e.g. 5 elements for sizes 0-4)
  repeated int32 free_inventory = 47;
}

message CharinfoRemove {
  string sender = 1;
}

message CharinfoJoined {
  string sender = 1;
}

message FieldUpdate {
  CharinfoFieldId field_id = 1;
  oneof value {
    int32 i32 = 2;
    int64 i64 = 3;
    float f = 4;
    string str = 5;
    fixed32 bits = 6;
    ClassInfo class_info = 7;
    TargetInfo target = 8;
    ZoneInfo zone = 9;
    ExperienceInfo experience = 10;
    MakeCampInfo make_camp = 11;
    MacroInfo macro = 12;
    SpellInfoList spell_list = 13;
    Int32List int32_list = 14;
    bool b = 15;
  }
}

message CharinfoUpdate {
  string sender = 1;
  repeated FieldUpdate updates = 2;
}

message CharinfoMessage {
  CharinfoMessageId id = 1;
  CharinfoPublish publish = 2;
  CharinfoRemove remove = 3;
  CharinfoUpdate update = 4;
  CharinfoJoined joined = 5;
}
